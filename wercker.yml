box: node:0.10

services:
  - mongo
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - script:
        name: add node_modules to $PATH
        code: |
          export NODE_ENV='development'
          export PATH=$PATH:./node_modules/.bin

    - script:
        name: export MONGODB_URI
        code: |
          export MONGODB_URI="mongodb://${MONGO_PORT_27017_TCP_ADDR}:${MONGO_PORT_27017_TCP_PORT}/db"

    # this is needed so that you can run `wercker build` locally (where node_modules is copied over)
    - script:
        name: cleanup local files
        code: |
          rm -rf node_modules
          rm -rf testapp/node_modules

    # A step that executes `npm install` command
    - npm-install
    # A step that executes `npm test` command
    - npm-test